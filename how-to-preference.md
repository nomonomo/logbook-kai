# 航海日誌 使い方

航海日誌を使用しながら艦これで遊ぶには、以下の設定が必要となります。

* 証明書の作成と証明書のインストール
* プロキシ設定

# 証明書の作成と証明書のインストール

2025年10月より、艦これがHTTPS化されました。そのため、従来の形式ではデータを受信できなくなりました。

本ソフトでは、MITM (Man-In-The-Middle) Proxyという形でデータを受信しています。これを実現するためには、証明書の作成と、その証明書をブラウザに信頼させる必要があります。

## 証明書の作成

### 1. 初回起動時のメッセージ

初回起動時には証明書が存在しないため、以下のメッセージが表示されます。

![サーバー証明書ファイルが見つかりません](images/certificate_1.png)

### 2. 証明書作成画面を開く

OKを押すと `[設定] - [通信]` 画面が開きますので、「証明書作成」ボタンをクリックしてください。

![設定-通信](images/certificate_2.png)

### 3. 証明書を作成する

証明書作成画面が表示されます。

![証明書作成](images/certificate_3.png)

「出力先ディレクトリ」は初期値として起動ディレクトリが設定されていますので、そのまま「作成」ボタンをクリックしてください。

![情報](images/certificate_4.png)

上記のメッセージが表示されれば、証明書の作成は完了です。

### 注意事項

`[設定] - [通信]` の「サーバー証明書ファイル」には、起動ディレクトリの `kancolle.p12` ファイルが指定されているはずです。「ファイルが見つかりません」などのエラーが出た場合は、パスを確認してください。

また、`[設定]` 画面をOKで閉じる際に、サーバー証明書ファイルに問題がある場合は以下のメッセージが表示されます。

![証明書読込エラー](images/certificate_5.png)

この場合は、再度 `[設定]` を開き、証明書の作成をやり直してください。

## 証明書のインストール（Windows標準）

作成された `logbook-ca.crt` ファイルをダブルクリックすると、証明書の情報画面が開きます。

![証明書](images/certificate_11.png)

### 1. インポートウィザードを開始

「証明書のインストール」ボタンをクリックします。

![証明書のインポートウィザード1](images/certificate_12.png)

保存場所は「現在のユーザー」を選択し、「次へ」をクリックします。

### 2. 証明書ストアを選択

![証明書のインポートウィザード2](images/certificate_13.png)

「証明書をすべて次のストアに配置する」を選択し、「参照」ボタンをクリックします。

![証明書ストアの選択](images/certificate_14.png)

「信頼されたルート証明機関」を選択し、OKをクリックします。

### 3. インポートを完了

![証明書のインポートウィザード3](images/certificate_15.png)

「完了」ボタンをクリックします。

![セキュリティ警告](images/certificate_16.png)

セキュリティ警告が表示されたら、「はい」を選択します。

これで証明書のインストールが完了しました。

### ⚠️ 重要：ブラウザの再起動が必要です

証明書のインストール後、**必ずブラウザを再起動してください**。

ブラウザを再起動しないと、証明書が正しく認識されず、艦これにアクセスできない場合があります。

## Firefoxをお使いの場合

Firefoxは独自の証明書ストアを使用できるため、上記の手順とは異なる方法で証明書をインストールすることができます。

詳細な手順については、[Firefox専用の証明書インストール手順](how-to-certificate-firefox.md)を参照してください。

---

# プロキシ設定

航海日誌を使用しながら艦これで遊ぶには、プロキシの設定が必要となります。

プロキシ設定には、以下の2つの方法があります。

**方法1：PACファイルを保存して使用する方法**  
従来の方法です。PACファイルをローカルに保存して使用します。  
この方法では、航海日誌を起動していない状態では艦これにアクセスできなくなります。

**方法2：URLから読み込む方法（推奨）**  
`http://localhost:8888/proxy.pac` を直接設定する方法です。ファイルの保存が不要で、より簡単に設定できます。  
**⚠️ 重要：** この方法では、航海日誌が起動していない場合、PACファイルにアクセスできないため、ブラウザはプロキシ設定を無視して艦これに直接アクセスしてしまいます。**航海日誌を起動してから艦これにアクセスするよう、立ち上げ漏れに注意してください。**

**注意事項**  
- デフォルトのポート番号は8888です。`[設定] - [通信]` でポート番号を変更した場合は、URLのポート番号も変更してください（例：`http://localhost:9999/proxy.pac`）。
- 航海日誌を使用しない場合は、プロキシ設定を元に戻してください（逆の手順で戻します）。

お使いのブラウザによって設定方法が異なりますので、以下の該当する項目を参照してください。

* Mozilla Firefoxの場合
* Google Chrome / Microsoft Edgeの場合

## Firefoxの場合

### 方法1：URLから読み込む方法（推奨）

Firefoxの [オプション](about:preferences) を開き、`[一般] - [ネットワーク設定] - [接続設定]` を選択します。

「自動プロキシ設定スクリプトURL」に、以下のURLを入力します。

```
http://localhost:8888/proxy.pac
```

**注意：** `[設定] - [通信]` でポート番号を変更した場合は、URLのポート番号も変更してください。

![preferences](images/firefox_4.png)

設定は以上です。

### 方法2：PACファイルを保存して使用する方法

#### 1. 自動プロキシ構成スクリプトを開く

航海日誌を起動後、`[その他] - [自動プロキシ構成スクリプト]` を選択します。

![メイン画面](images/firefox_1.png)

**※ 注意**  
航海日誌が「スレッドが予期せず終了しました」というエラーメッセージを出した場合、ポートを8888から任意の別のポートに変更してください。

#### 2. スクリプトファイルを保存してアドレスをコピー

「保存...」を選択してスクリプトファイルを保存した後、Firefox用のアドレスをコピーします。

![自動プロキシ構成スクリプト](images/firefox_2.png)

#### 3. Firefoxの接続設定に登録

Firefoxの [オプション](about:preferences) を開き、`[一般] - [ネットワーク設定] - [接続設定]` を選択します。

「自動プロキシ設定スクリプトURL」に、先ほどコピーしたアドレスを貼り付けます。

![preferences](images/firefox_3.png)

設定は以上です。

## Chrome / Edgeの場合

Google ChromeやMicrosoft Edgeでは、以下の2つの方法でプロキシ設定が可能です。

### 方法1：起動コマンドにオプションを追加する方法（推奨）

ChromeやEdgeを起動する際に、以下のオプションを追加して起動します。

```
--proxy-pac-url=http://localhost:8888/proxy.pac
```

**Windowsでの設定例：**

1. Chrome/Edgeのショートカットを右クリックして「プロパティ」を開く
2. 「リンク先」の末尾に、スペースを空けて上記のオプションを追加
   - 例：`"C:\Program Files\Google\Chrome\Application\chrome.exe" --proxy-pac-url=http://localhost:8888/proxy.pac`
3. 「OK」をクリックして保存

**注意：** `[設定] - [通信]` でポート番号を変更した場合は、URLのポート番号も変更してください。

### 方法2：拡張機能を使用する方法

Chrome/Edge単体ではプロキシの設定ができないため、拡張機能のインストールが必要です。

ここでは [SwitchySharp](https://chrome.google.com/webstore/detail/proxy-switchysharp/dpplabbmogkhghncfbfdeeokoefdjegm) を例にして説明します。

拡張機能を使用する場合、以下の方法があります。

#### PACファイルをインポートする方法

**補足：** 一部の拡張機能では、PAC URLを直接指定する方法も利用可能です。ただし、現在のところ、具体的な設定手順については説明できません。拡張機能のマニュアルやヘルプを参照してください。

PACファイルをインポートする方法は以下の通りです。

1. 自動プロキシ構成スクリプトを開く

   航海日誌を起動後、`[その他] - [自動プロキシ構成スクリプト]` を選択します。

   ![メイン画面](images/chrome_1.png)

   **※ 注意**  
   航海日誌が「スレッドが予期せず終了しました」というエラーメッセージを出した場合、ポートを8888から任意の別のポートに変更してください。

2. スクリプトファイルを保存

   「保存...」を選択してスクリプトファイルを保存します。

   （Firefox用のアドレスは使用しません）

   ![自動プロキシ構成スクリプト](images/chrome_2.png)

3. SwitchySharpにプロファイルを作成

   SwitchySharpのオプションで新しいプロファイルを作成します。

   「Import PAC File」を選択し、前の手順で作成したPACファイルを選択して保存します。

   ![SwitchySharp](images/chrome_3.png)

4. プロファイルを有効にする

   作成したプロファイルを有効にします。

   ![SwitchySharp](images/chrome_4.png)

設定は以上です。
